# 2D Рейкастер с Эффектом Мягких Теней (Qt)

Этот проект представляет собой 2D-рейкастер, разработанный с использованием Qt.

## Ключевые Возможности

*   **Динамический Источник Света:**
    *   Положение основного источника света можно динамически изменять с помощью мыши в режиме "Light".
*   **Мягкие Тени через Несколько Источников Света:**
    *   В режиме "Light" вокруг основного, управляемого мышью, источника света автоматически располагаются дополнительные источники по окружности.
    *   Каждый из этих источников света отбрасывает свою собственную полупрозрачную освещенную область.
    *   Наложение этих полупрозрачных областей друг на друга создает эффект мягких теней (полутеней).
*   **Многоугольники-Препятствия:**
    *   Пользователи могут создавать произвольные многоугольники, которые выступают в роли препятствий.
    *   **Динамическое создание:** При добавлении вершин (ЛКМ), последняя добавленная вершина следует за курсором мыши, позволяя видеть предварительную форму многоугольника в реальном времени до его завершения (ПКМ).
    *   Эти препятствия блокируют свет и отбрасывают тени.
*   **Визуализация Освещения и Теней:**
    *   Приложение отображает области, освещенные источниками света, с учетом теней, отбрасываемых препятствиями.
*   **Автоматический Граничный Многоугольник:**
    *   Границы окна приложения автоматически формируют ограничивающий многоугольник, который определяет пределы распространения света и обновляется при изменении размеров окна.
*   **Интерактивные Режимы:**
    *   Возможность переключения между режимом **"Light" (Освещение)** для управления источником света и режимом **"Polygons" (Многоугольники)** для создания препятствий.

## Основные Компоненты

*   **`Ray` (Луч):** Представляет собой единичный луч света с начальной/конечной точками и углом.
*   **`Polygon` (Многоугольник):** Представляет собой многоугольное препятствие или область света. Включает методы для добавления и обновления вершин.
*   **`Controller` (Контроллер):** Управляет коллекцией многоугольников-препятствий для **одного** источника света. Отвечает за:
    *   Управление данными многоугольников.
    *   Расчет области освещения: генерация лучей к вершинам, поиск ближайших пересечений с препятствиями, оптимизация (удаление близкорасположенных лучей).
*   **`Canvas` (Холст, QWidget):** Основная область для отрисовки и взаимодействия с пользователем.
    *   Управляет вектором `Controller`'ов (основной + вспомогательные для мягких теней).
    *   Отрисовывает многоугольники, источники света и рассчитанные области освещения.
    *   Обрабатывает события мыши для управления светом и создания многоугольников.
*   **`MainWindow` (Главное Окно, QMainWindow):** Главное окно приложения, содержит `QComboBox` для переключения режимов и интегрирует `Canvas`.

## Режимы Работы и Управление

1.  **Режим "Light" (Освещение):**
    *   **Управление:** Перемещение мыши или Клик ЛКМ устанавливает позицию основного источника света. Вспомогательные источники обновляются автоматически.
    *   **Визуализация:** Отображение освещенных областей и теней от всех активных источников.

2.  **Режим "Polygons" (Многоугольники):**
    *   **Создание Многоугольника:**
        *   **ЛКМ (Левая Кнопка Мыши):**
            *   Первый клик: Начинает новый многоугольник, добавляя первые две вершины в точке клика.
            *   Последующие клики: Добавляют новые вершины к текущему многоугольнику.
        *   **Перемещение Мыши (во время создания):** Если многоугольник еще не завершен (ПКМ не нажата), последняя добавленная вершина динамически следует за курсором мыши. Это позволяет видеть, как будет выглядеть ребро многоугольника, и корректировать его положение перед фиксацией.
        *   **ПКМ (Правая Кнопка Мыши):** Завершает создание текущего многоугольника.
    *   **Визуализация:** Отображение создаваемых и существующих многоугольников-препятствий.

## Как Работают Мягкие Тени

Эффект мягких теней (полутеней) достигается путем:
1.  Определения основного источника света, управляемого мышью.
2.  Создания нескольких вторичных, слегка смещенных источников света, расположенных по кругу вокруг основного.
3.  Каждый источник света (основной и вторичные) независимо рассчитывает свою область освещения.
4.  Эти области освещения рисуются полупрозрачным цветом.
5.  В местах, где эти полупрозрачные области накладываются, интенсивность света суммируется, создавая плавный переход от полностью освещенных зон к полутеням и глубоким теням.